{% extends 'base.html' %} {% load fontawesome_5 %} {% load static %} {% block content %}
<style>
    .table {
        table-layout: fixed;
    }
    
    td {
        word-wrap: break-word;
    }
    
    .wrapper {
        display: block;
    }
    
    .sidebar-left {
        width: 250px;
        height: 100vh;
        position: fixed;
        top: 0;
        left: -255px;
        z-index: 999;
        background: #343a40;
        color: #fff;
        transition: all .3s;
        box-shadow: 3px 3px 3px rgba(51, 51, 51, 0.5);
        text-align: left;
    }
    
    .sidebar-left.active {
        left: 0;
    }
    
    .overlay {
        display: none;
        position: fixed;
        width: 100vw;
        height: 100vh;
        background: rgba(51, 51, 51, 0.7);
        z-index: 998;
        opacity: 0;
        transition: all .5s ease-in-out;
    }
    
    .overlay.active {
        display: block;
        opacity: 1;
        position: fixed;
        top: 0;
        left: 0;
    }
    
    .open-menu {
        position: fixed;
        top: 50px;
        left: 15px;
        z-index: 997;
        box-shadow: 3px 3px 3px rgba(51, 51, 51, 0.2);
    }
    
    .dismiss {
        width: 35px;
        height: 35px;
        position: absolute;
        top: 10px;
        right: 10px;
        transition: all .3s;
        background: #444;
        border-radius: 4px;
        text-align: center;
        line-height: 35px;
        cursor: pointer;
    }
    
    .dismiss:hover,
    .dismiss:focus {
        background: #555;
        color: #fff;
    }
    
    .sidebar-left ul.menu-elements {
        padding: 10px 0;
        border-bottom: 1px solid #444;
        transition: all .3s;
    }
    
    .sidebar-left ul li a {
        display: block;
        padding: 10px 20px;
        border: 0;
        color: #fff;
    }
    
    .sidebar-left ul li a:hover,
    .sidebar-left ul li a:focus,
    .sidebar-left ul li.active a:hover,
    .sidebar-left ul li.active a:focus {
        outline: 0;
        background: #555;
        color: #fff;
    }
    
    .sidebar-left ul li a i {
        margin-right: 5px;
    }
    
    .sidebar-left ul li.active a {
        background: #444;
        color: #fff;
    }
    
    .sidebar-left ul ul a {
        background: #444;
        padding-left: 30px;
        font-size: 14px;
    }
    
    .sidebar-left ul ul li.active a {
        background: #555;
    }
    
    .sidebar-left a[data-toggle="collapse"] {
        position: relative;
    }
    
    .sidebar-left .dropdown-toggle::after {
        display: block;
        position: absolute;
        top: 50%;
        right: 20px;
        transform: translateY(-50%);
    }
    
    .sidebar-left ul li a span {
        margin-left: 3px;
    }
    
    .to-top {
        position: fixed;
        right: 10px;
        bottom: 10px;
    }
    
    .sidebar-title h3 a {
        color: white;
        margin: 5px;
    }
    
    .rotate svg {
        -moz-transition: all 0.5s linear;
        -webkit-transition: all 0.5s linear;
        transition: all 0.5s linear;
    }
    
    .rotate.down {
        color: green;
    }
    
    .rotate.down svg {
        -ms-transform: rotate(90deg);
        -moz-transform: rotate(90deg);
        -webkit-transform: rotate(90deg);
        transform: rotate(90deg);
    }
</style>
<div id="wrapper">
    <!-- Sidebar -->
    <nav class="sidebar sidebar-left bg-dark">

        <!-- close sidebar menu -->
        <div class="dismiss">
            {% fa5_icon 'chevron-left' %}
        </div>

        <div class="sidebar-title">
            <h3><a class="nav-link" href="{% url 'home' %}">Mobile Audit</a></h3>
        </div>

        <ul class="list-unstyled menu-elements">
            <li>
                <a class="scroll-link" href="#info">{% fa5_icon 'mobile-alt' %} <span>App Info</span></a>
            </li>
            <li>
                <a class="scroll-link" href="#security">{% fa5_icon 'lock' %} <span>Security info</span></a>
            </li>
            <li>
                <a class="scroll-link" href="#permissions">{% fa5_icon 'id-card' %} <span>Permissions</span></a>
            </li>
            <li>
                <a class="scroll-link" href="#activities">{% fa5_icon 'running' %} <span>Activities</span></a>
            </li>
            <li>
                <a class="scroll-link" href="#components">{% fa5_icon 'sitemap' %} <span>Components</span></a>
            </li>
            <li>
                <a class="scroll-link" href="#findings">{% fa5_icon 'bug' %} <span>Findings</span></a>
            </li>
            <li>
                <a class="scroll-link" href="#best_practices">{% fa5_icon 'clipboard-check' %} <span>Security Best Practices</span></a>
            </li>
            {% if settings.VIRUSTOTAL_ENABLED %}
            <li>
                <a class="scroll-link" href="#antivirus">{% fa5_icon 'shield-alt' %} <span>Antivirus</span></a>
            </li>
            {% endif %}
            <li>
                <a class="scroll-link" href="#certificates">{% fa5_icon 'certificate' %} <span>Certificates</span></a>
            </li>
            <li>
                <a class="scroll-link" href="#strings">{% fa5_icon 'font' %} <span>Strings</span></a>
            </li>
            <li>
                <a class="scroll-link" href="#files">{% fa5_icon 'file' %} <span>Files</span></a>
            </li>
            <li>
                <a class="scroll-link" href="#databases">{% fa5_icon 'database' %} <span>Databases</span></a>
            </li>
            <li>
                <a class="scroll-link" href="{% url 'export' id=scan.id %}">{% fa5_icon 'download' %} <span>Export</span></a>
            </li>
        </ul>
    </nav>
    <!-- End sidebar -->
    <div class="overlay"></div>
    <div class="content">
        <a class="btn btn-dark open-menu" href="#" role="button">
            {% fa5_icon 'bars' %}
        </a>
        <button class="btn btn-sm btn-outline-secondary" onclick="window.history.back()">{% fa5_icon 'chevron-left' %} Back </button>
        <button class="btn btn-sm btn-outline-success" onclick="window.location.reload()">{% fa5_icon 'redo-alt' %} Refresh </button>
        <div class="card">
            <div class="card-body">
                <h4 class="card-title">Scan</h4>
                <div id="progress-wrapper">
                    <p><b>Description: </b> {{ scan.description }}</p>
                    <p><b>Created by: </b> {{ scan.user.username }}</p>
                    <p><b>Status:</b> {{ scan.status }}</p>
                    <div class="progress">
                        {% if scan.progress == 100 %}
                        <div class="progress-bar bg-success progress-bar-striped" id="progress-bar" style="width: {{ scan.progress }}%" role="progressbar" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">{{ scan.progress }} %</div>
                        {% else %}
                        <div class="progress-bar bg-primary progress-bar-striped progress-bar-animated" id="progress-bar" style="width: {{ scan.progress }}%" role="progressbar" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">{{ scan.progress }} %</div>
                        {% endif %}
                    </div>
                </div>
                {% if scan.progress >= 40 %}
                <br>
                <a href="{% url 'export' id=scan.id %}" class="btn btn-outline-dark">Export {% fa5_icon 'download' %}</a> {% endif %}
            </div>
        </div>
        {% if app.name %}
        <br>
        <div class="card">
            <div class="card-body">
                <a name="info"></a>
                <h5 class="card-title">Application info</h5>

                <table class="table table-striped table-bordered">
                    {% if app.icon %}
                    <tr>
                        <th>Icon</th>
                        <td><img class="img-thumbnail" alt="embedded" src="data:image/png;base64,{{ app.icon }}" /></td>
                    </tr>
                    {% endif %}
                    <tr>
                        <th>App name</th>
                        <td>{{ app.name }}</td>
                    </tr>
                    <tr>
                        <th>Package</th>
                        <td>{{ app.package }}</td>
                    </tr>
                    <tr>
                        <th>Version name</th>
                        <td>{{ app.version_name }}</td>
                    </tr>
                    <tr>
                        <th>Version code</th>
                        <td>{{ app.version_code }}</td>
                    </tr>
                    <tr>
                        <th>Min version</th>
                        <td>{{ app.min_sdk_version }}</td>
                    </tr>
                    <tr>
                        <th>Max version</th>
                        <td>{{ app.max_sdk_version }}</td>
                    </tr>
                    <tr>
                        <th>Target version</th>
                        <td>{{ app.target_sdk_version }}</td>
                    </tr>
                    <tr>
                        <th>Effective version</th>
                        <td>{{ app.effective_target_sdk_version }}</td>
                    </tr>
                    <tr>
                        <th>File size</th>
                        <td>{{ app.file_size }}</td>
                    </tr>
                    <tr>
                        <th>md5</th>
                        <td>{{ app.md5 }}</td>
                    </tr>
                    <tr>
                        <th>sha256</th>
                        <td>{{ app.sha256 }}</td>
                    </tr>
                </table>
            </div>
        </div>
        {% endif %} {% if scan.progress >= 40 %}
        <br>
        <div class="card">
            <div class="card-body">
                <a name="security"></a>
                <h5 class="card-title">Security info</h5>
                <table class="table table-bordered">
                    <tr>
                        <th style="width: 30%;">Number of findings</th>
                        <td><a href="{% url 'findings' scan_id=scan.id %}" target="_blank">{{ scan.findings }}</a></td>
                    </tr>
                    <tr>
                        <th style="width: 30%;">By Severity</th>
                        <td>
                            <table class="table table-borderless">
                                {% for severity, number in findings_by_severity.items %}
                                <tr>
                                    <th> {{ severity }} </th>
                                    {% if severity == 'Critical' %}
                                    <td>{% fa5_icon 'exclamation-circle' color='black' %} {{ number }} </td>
                                    {% elif severity == 'High' %}
                                    <td>{% fa5_icon 'exclamation-circle' color='red' %} {{ number }} </td>
                                    {% elif severity == 'Medium'%}
                                    <td>{% fa5_icon 'exclamation-circle' color='orange' %} {{ number }}</td>
                                    {% elif severity == 'Low' %}
                                    <td>{% fa5_icon 'exclamation-circle' color='blue' %} {{ number }}</td>
                                    {% else %}
                                    <td>{% fa5_icon 'check-circle' color='green' %} {{ number }}</td>
                                    {% endif %}
                                </tr>
                                {% endfor %}
                            </table>
                        </td>
                    </tr>
                    {% if settings.VIRUSTOTAL_ENABLED %}
                    <tr>
                        <th style="width: 30%;">Detections in VT</th>
                        {% if antivirus_scan.malicious > 0 %}
                        <td> {% fa5_icon 'shield-alt' color='red' %} {{ antivirus_scan.malicious }}</td>
                        {% else %}
                        <td> {% fa5_icon 'shield-alt' color='green' %} {{ antivirus_scan.malicious }}</td>
                        {% endif %}
                    </tr>
                    {% endif %}
                </table>
            </div>
        </div>
        {% endif %} {% if permissions %}
        <br>
        <div class="card">
            <div class="card-body">
                <a name="permissions"></a>
                <h5 class="card-title">Permissions</h5>
                <table class="table table-striped table-bordered table-order">
                    <thead>
                        <tr>
                            <th style="width: 5%;">ID</th>
                            <th style="width: 70%;">Name</th>
                            <th style="width: 15%;">Type</th>
                            <th style="width: 10%;">Severity</th>
                            <th style="width: 10%;">Status</th>
                        </tr>
                    </thead>
                    <tbody>

                        {% for p in permissions %}
                        <tr>
                            <td>{{ forloop.counter }}</td>
                            <td>{{ p.permission.name }} </td>
                            <td>{{ p.permission.type }} </td>
                            <td>{{ p.get_severity_display }} </td>
                            {% if p.severity == 'HI' %}
                            <td>{% fa5_icon 'exclamation-circle' color='red' %}</td>
                            {% elif p.severity == 'ME' %}
                            <td>{% fa5_icon 'exclamation-circle' color='orange' %}</td>
                            {% else %}
                            <td>{% fa5_icon 'check-circle' color='green' %}</td>
                            {% endif %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% endif %} {% if activities %}
        <br>
        <div class="card">
            <div class="card-body">
                <a name="activities"></a>
                <h5 class="card-title">Activities</h5>
                <table class="table table-striped table-bordered table-order">
                    <thead>
                        <tr>
                            <th style="width: 5%;">ID</th>
                            <th style="width: 70%;">Name</th>
                            <th style="width: 15%;">Main</th>
                        </tr>
                    </thead>
                    <tbody>

                        {% for a in activities %}
                        <tr>
                            <td>{{ a.id }}</td>
                            <td>{{ a.name }} </td>
                            {% if a.main %}
                            <td>{% fa5_icon 'check-circle' color='green' %}</td>
                            {% else %}
                            <td>{% fa5_icon 'times-circle' color='red' %}</td>
                            {% endif %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% endif %} {% if components_intents %}
        <br>
        <div class="card">
            <div class="card-body">
                <a name="components"></a>
                <h5 class="card-title">Components</h5>
                <table class="table table-bordered table-order">
                    <thead>
                        <tr>
                            <th style="width: 5%;">ID</th>
                            <th style="width: 10%;">Type</th>
                            <th style="width: 40%;">Name</th>
                            <th style="width: 40%;">Intents</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for component, intents in components_intents %}
                        <tr>
                            <td>{{ component.id }}</td>
                            <td>{{ component.type }} </td>
                            <td>{{ component.name }} </td>
                            <td>
                                {% if intents %}
                                <table class="table table-borderless table-striped">
                                    <thead>
                                        <tr>
                                            <th style="width: 5%;">ID</th>
                                            <th style="width: 35%;">Intent</th>
                                            <th style="width: 20%;">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for intent in intents %}
                                        <tr>
                                            <td>{{ intent.id }}</td>
                                            <td>{{ intent.name }}</td>
                                            <td>{{ intent.action }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% endif %} {% if certificates %}
        <br>
        <div class="card">
            <div class="card-body">
                <a name="certificates"></a>
                <h5 class="card-title">Certificates</h5>
                <table class="table table-striped table-bordered table-order">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Version</th>
                            <th>Subject</th>
                            <th>Issuer</th>
                            <th>Hash algorithm</th>
                            <th>Signature algorithm</th>
                            <th>Serial number</th>
                            <th>Sha1</th>
                            <th>Sha256</th>
                        </tr>
                    </thead>
                    <tbody>

                        {% for certificate in certificates %}
                        <tr>
                            <td>{{ certificate.id }}</td>
                            <td>{{ certificate.version }} </td>
                            <td>{{ certificate.subject }} </td>
                            <td>{{ certificate.issuer }} </td>
                            <td>{{ certificate.hash_algorithm }} </td>
                            <td>{{ certificate.signature_algorithm }} </td>
                            <td>{{ certificate.serial_number }} </td>
                            <td>{{ certificate.sha1 }}</td>
                            <td>{{ certificate.sha256 }}</td>
                        </tr>
                        {% endfor %}

                    </tbody>
                </table>
            </div>
        </div>{% endif %} {% if settings.VIRUSTOTAL_ENABLED and antivirus_scan %}
        <br>
        <div class="card">
            <div class="card-body">
                <a name="antivirus"></a>
                <h5 class="card-title">Virus Total Scan</h5>
                <button class="btn btn-outline-primary" onclick="updateVirusTotal({{ scan.id }})">{% fa5_icon 'redo-alt' %} VT Reload </button> {% if antivirus_scan.link %}
                <a href="{{ settings.VIRUSTOTAL_FILE_URL }}{{ antivirus_scan.identifier }}" target="_blank" class="btn btn-outline-dark">VT Link {% fa5_icon 'external-link-alt' %}</a> {% endif %}
                <br>
                <table class="table table-bordered">
                    <tr>
                        <th style="width: 20%">ID</th>
                        <td>{{ antivirus_scan.identifier }}</td>
                    </tr>
                    <tr>
                        <th>Data</th>
                        <td>
                            <table class="table table-borderless">
                                <tr>
                                    <th> Type </th>
                                    <td> {{ antivirus_scan.type }}</td>
                                </tr>
                                <tr>
                                    <th>Magic</th>
                                    <td>{{ antivirus_scan.magic }}</td>
                                </tr>
                                <tr>
                                    <th>Reputation</th>
                                    <td>{{ antivirus_scan.reputation }}</td>
                                </tr>
                                <tr>
                                    <th>Uploaded</th>
                                    {% if antivirus_scan.uploaded %}
                                    <td>Yes</td>
                                    {% else %}
                                    <td>No</td>
                                    {% endif %}
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <th>Date</th>
                        <td>
                            <table class="table table-borderless">
                                <tr>
                                    <th> Last scan date </th>
                                    <td> {{ antivirus_scan.date }}</td>
                                </tr>
                                <tr>
                                    <th>First seen</th>
                                    <td>{{ antivirus_scan.first_seen }}</td>
                                </tr>
                                <tr>
                                    <th>First submission</th>
                                    <td>{{ antivirus_scan.first_submission}}</td>
                                </tr>
                                <tr>
                                    <th>Last submission</th>
                                    <td>{{ antivirus_scan.last_submission}}</td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <th>Last scan</th>
                        <td>
                            <table class="table table-borderless">
                                <tr>
                                    <th>Malicious</th>
                                    <td style="color:red">{{ antivirus_scan.malicious }}</td>
                                </tr>
                                <tr>
                                    <th>Harmless</th>
                                    <td style="color:green">{{ antivirus_scan.harmless }}</td>
                                </tr>
                                <tr>
                                    <th>Suspicious</th>
                                    <td>{{ antivirus_scan.suspicious }}</td>
                                </tr>
                                <tr>
                                    <th>Undetected</th>
                                    <td>{{ antivirus_scan.undetected }}</td>
                                </tr>
                                <tr>
                                    <th>Timeout</th>
                                    <td>{{ antivirus_scan.timeout }}</td>
                                </tr>
                                <tr>
                                    <th>Unsupported</th>
                                    <td>{{ antivirus_scan.unsupported }}</td>
                                </tr>
                                <tr>
                                    <th>Type Unsupported</th>
                                    <td>{{ antivirus_scan.type_unsupported }}</td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <th>Hashes</th>
                        <td>
                            <table class="table table-borderless">
                                <tr>
                                    <th>md5</th>
                                    <td>{{ antivirus_scan.md5 }}</td>
                                </tr>
                                <tr>
                                    <th>sha256</th>
                                    <td>{{ antivirus_scan.sha256 }}</td>
                                </tr>
                                <tr>
                                    <th>ssdeep</th>
                                    <td>{{ antivirus_scan.ssdeep }}</td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <th>Votes</th>
                        <td>
                            <table class="table table-borderless">
                                <tr>
                                    <th>Harmless</th>
                                    <td style="color:green">{{ antivirus_scan.votes_harmless }}</td>
                                </tr>
                                <tr>
                                    <th>Malicious</th>
                                    <td style="color:red">{{ antivirus_scan.votes_malicious }}</td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </table>
                {% if antivirus %}

                <table class="table table-striped table-bordered table-order-paginate">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Antivirus</th>
                            <th>Version</th>
                            <th>Category</th>
                            <th>Result</th>
                            <th>Update</th>
                            <th>Detected</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for av in antivirus %}
                        <tr>
                            <td>{{ av.id }}</td>
                            <td>{{ av.name }} </td>
                            <td>{{ av.version }} </td>
                            <td>{{ av.category }} </td>
                            <td>{{ av.result }} </td>
                            <td>{{ av.update }} </td>
                            {% if av.result != null %}
                            <td>Yes</td>
                            <td>{% fa5_icon 'check-circle' color='red' %}</td>
                            {% else %}
                            <td>No</td>
                            <td>{% fa5_icon 'times-circle' color='green' %}</td>
                            {% endif %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% endif %}
            </div>
        </div>
        {% endif %} {% if findings or scan.progress >= 40 %}
        <br>
        <div class="card">
            <div class="card-body">
                <a name="findings"></a>
                <h5 class="card-title">Findings</h5>
                <a href="{% url 'create_finding' scan_id=scan.id %}" target="_blank" class="btn btn-outline-info">New Finding</a>
                <p>Number of findings: {{ scan.findings }}</p>
                <form id="form-findings" action="{% url 'findings' %}" method="post" enctype="multipart/form-data">
                    <input type="hidden" name="scan" value="{{ scan.id }}">
                    <div class="btn-group mr-2">
                        <button class="btn btn-sm btn-outline-primary dropdown-toggle" type="button" id="dropdownMenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                            Bulk Edit
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="dropdownMenu" id="bulk_edit">
                            <li style="margin: 15px;">
                                <label style="display: block" for="severity">Severity</label>
                                <select name="severity" id="severity">
                                    <option value="">Choose Severity</option>
                                    <option value="NO">None</option>
                                    <option value="LO">Low</option>
                                    <option value="ME">Medium</option>
                                    <option value="HI">High</option>
                                    <option value="CR">Critical</option>
                                </select>
                                <label style="display: block" for="status">Status</label>
                                <select name="status" id="status">
                                    <option value="">Choose Status</option>
                                    <option value="VF">Verified</option>
                                    <option value="FP">False Positive</option>
                                    <option value="TP">True Positive</option>
                                    <option value="UK">Unknown</option>
                                    <option value="TD">To Do</option>
                                </select> {% if settings.DEFECTDOJO_ENABLED %}
                                <br>
                                <label>Push to Defect Dojo
                      <input id="id_push_dojo" name="push_dojo" type="checkbox" alt="Select to push to Dojo"/>
                    </label> {% endif %}
                                <br>
                                <input type="submit" name="edit_findings" class="btn btn-sm btn-primary" value="Edit Findings">
                            </li>
                        </ul>
                        <input type="submit" name="view_findings" class="btn btn-sm btn-outline-warning" value="View Findings">
                        <input type="submit" name="delete_findings" class="btn btn-sm btn-outline-danger" value="Delete Findings">
                    </div>
                    {% csrf_token %}
                    <table class="table table-order table-bordered">
                        <thead>
                            <tr>
                                <th style="width: 3%;"><input id="id_select_all" name="select_all" type="checkbox" /></th>
                                <th style="width: 4%;">ID</th>
                                <th style="width: 10%;">Finding</th>
                                <th style="width: 8%;">Number</th>
                                <th style="width: 90%;">Findings</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for category in categories %} {% with id=category.id %} {% if findings_ordered|lookup:id %}
                            <tr>
                                <td>
                                    <input id="id_select_category_{{ category.id }}" name="select_category" category="{{ category.id }}" type="checkbox" />
                                </td>
                                <td>{{ category.id }}</td>
                                <td>{{ category.default_name }}</td>
                                <td>{{ findings_ordered| lookup:id|length }}
                                    <a class="rotate" href="#category_{{id}}" data-toggle="collapse" data-target="#category_{{id}}" role="button" aria-expanded="false" aria-controls="category_{{id}}">{% fa5_icon 'chevron-up' flip='vertical' %}</a>
                                </td>
                                <td id="category_{{id}}" class="collapse">
                                    <div>
                                        <table class="table table-borderless table-striped table-order">
                                            <thead>
                                                <tr>
                                                    <th style="width: 3%;"><input id="id_select_findings_category_{{ category.id }}" name="select_category" category="{{ category.id }}" type="checkbox" /></th>
                                                    <th style="width: 6%;">ID</th>
                                                    <th style="width: 8%;">Severity</th>
                                                    <th style="width: 30%;">File</th>
                                                    <th style="width: 6%;">LN</th>
                                                    <th style="width: 30%;">Line</th>
                                                    <th style="width: 8%;">Status</th>
                                                    <th style="width: 7%;">CWE</th>
                                                    {% if settings.DEFECTDOJO_ENABLED %}
                                                    <th style="width: 7%;">Dojo ID</th>
                                                    {% endif %}
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for finding in findings_ordered|lookup:id %}
                                                <tr>
                                                    <td><input id="{{ finding.id }}" class="finding select_finding_{{ category.id }}" name="{{ finding.id }}" type="checkbox" /></td>
                                                    <td><a href="{% url 'finding' id=finding.id %}" target="_blank">{{ finding.id }}</a></td>
                                                    <td>{{ finding.get_severity_display }}</td>
                                                    <td><a href="{% url 'finding_view_file' id=finding.id %}" target="_blank">{{ finding.path }}</a></td>
                                                    <td><a href="{% url 'finding_view_file' id=finding.id %}#finding" target="_blank">{{ finding.line_number }}</a></td>
                                                    <td>{{ finding.line }}</td>
                                                    <td>{{ finding.get_status_display }}</td>
                                                    <td><a href="{{ settings.CWE_URL }}{{ finding.cwe.cwe }}.html" target="_blank">{{ finding.cwe.cwe }} </a></td>
                                                    {% if settings.DEFECTDOJO_ENABLED %}
                                                    <td>
                                                        {% if finding.defectdojo_id > 0 %}
                                                        <a href="{{ settings.DEFECTDOJO_URL }}{{ finding.defectdojo_id }}" target="_blank">{{ finding.defectdojo_id }}</a> {% else %} <span>N/A</span>{% endif %}
                                                    </td>
                                                    {% endif %}
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </td>
                            </tr>
                            {% endif %} {% endwith %}{% endfor %}
                        </tbody>
                    </table>
                </form>
            </div>
        </div>
        {% endif %} {% if all_practices and scan.progress >= 40 %}
        <br>
        <div class="card">
            <div class="card-body">
                <a name="best_practices"></a>
                <h5 class="card-title">Security Best Practices</h5>
                <table class="table table-bordered table-order">
                    <thead>
                        <tr>
                            <th style="width: 10%;">Name</th>
                            <th style="width: 25%;">Description</th>
                            <th style="width: 70%;">Implementation</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for practice in all_practices %}
                        <tr>
                            <td>{{ practice.default_name }} </td>
                            <td>{{ practice.default_description }} </td>
                            <td>
                                <table class="table table-borderless table-striped table-order-paginate">
                                    <thead>
                                        <tr>
                                            <th style="width: 6%;">ID</th>
                                            <th style="width: 40%;">Path</th>
                                            <th style="width: 7%;">LN</th>
                                            <th style="width: 50%;">Line</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for finding in best_practices %} {% if finding.type.id == practice.id %}
                                        <tr>
                                            <td><a href="{% url 'finding' id=finding.id %}" target="_blank">{{ finding.id }}</a></td>
                                            <td><a href="{% url 'finding_view_file' id=finding.id %}" target="_blank">{{ finding.path }}</a></td>
                                            <td><a href="{% url 'finding_view_file' id=finding.id %}#finding" target="_blank">{{ finding.line_number }}</a></td>
                                            <td>{{ finding.line }}
                                            </td>
                                        </tr>
                                        {% endif %} {% endfor %}
                                    </tbody>
                                </table>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% endif %} {% if files or scan.progress >= 40 %}
        <br>
        <div class="card">
            <div class="card-body">
                <a name="files"></a>
                <h5 class="card-title">Files</h5>
                <table class="table table-striped table-bordered table-order-paginate">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Path</th>
                            <th>Type</th>
                        </tr>
                    </thead>
                    <tbody>

                        {% for file in files %}
                        <tr>
                            <td>{{ file.id }}</td>
                            {% if file.type == 'html' %}
                            <td>{{ file.name }}</td>
                            {% else %}
                            <td><a href="{% url 'view_file' id=file.id %}" target="_blank">{{ file.name }} </a></td>
                            {% endif %}
                            <td>{{ file.type }} </td>
                        </tr>
                        {% endfor %}

                    </tbody>
                </table>
            </div>
        </div>{% endif %} {% if strings or scan.progress >= 40 %}
        <br>
        <div class="card">
            <div class="card-body">
                <a name="strings"></a>
                <h5 class="card-title">Strings</h5>
                <table class="table table-striped table-bordered table-order-paginate">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Type</th>
                            <th>Value</th>
                            <th>Finding</th>
                        </tr>
                    </thead>
                    <tbody>

                        {% for string in strings %}
                        <tr>
                            <td>{{ string.id }}</td>
                            <td>{{ string.type }} </td>
                            <td>{{ string.value }} </td>
                            <td><a href="{% url 'finding' id=string.finding.id %}" target="_blank">{{ string.finding.id }}</a></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% endif %} </div>
        </div> {% if database or scan.progress >= 40 %}
        <br>
        <div class="card">
            <div class="card-body">
                <a name="databases"></a>
                <h5 class="card-title">Databases</h5>
                <table class="table table-striped table-bordered table-order-paginate">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Table</th>
                            <th>Data</th>
                        </tr>
                    </thead>
                    <tbody>

                        {% for table in database %}
                        <tr>
                            <td>{{ table.id }}</td>
                            <td>{{ table.table }} </td>
                            <td>{{ table.info }} </td>
                        </tr>
                        {% endfor %}

                    </tbody>
                </table>
            </div>
        </div>
        {% endif %}
    </div>
</div>
<div class="to-top">
    <a class="btn btn-outline-secondary" href="#" role="button">
        {% fa5_icon 'chevron-up' %}
    </a>
</div>
<script type="text/javascript">
    $(document).ready(function() {
        $('#id_select_all').on('click', function() {
            $('.finding').prop('checked', this.checked);
            $('[name="select_category"]').prop('checked', this.checked);
        });
        $('[name="select_category"]').on('click', function() {
            var search = ".select_finding_" + $(this).attr('category');
            $(search).prop('checked', this.checked);
        });
        $('.dropdown-menu').click(function(e) {
            e.stopPropagation();
        });
        $('.table-order').each(function() {
            try {
                $(this).DataTable({
                    paging: false
                });
            } catch (error) {
                console.log(this)
            }
        });
        $('.table-order-paginate').each(function() {
            try {
                $(this).DataTable();
            } catch (error) {
                console.log(this)
            }
        });

        $('.dismiss, .overlay').on('click', function() {
            $('.sidebar').removeClass('active');
            $('.overlay').removeClass('active');
        });

        $('.open-menu').on('click', function(e) {
            e.preventDefault();
            $('.sidebar').addClass('active');
            $('.overlay').addClass('active');
            // close opened sub-menus
            $('.collapse.show').toggleClass('show');
            $('a[aria-expanded=true]').attr('aria-expanded', 'false');
        });

        $('.to-top a').on('click', function(e) {
            e.preventDefault();
            if ($(window).scrollTop() != 0) {
                $('html, body').stop().animate({
                    scrollTop: 0
                }, 1000);
            }
        });

        $('[name="delete_findings"]').on('click', function(e) {
            if (!confirm('Do you really want to delete the findings?')) {
                e.preventDefault();
            }
        });

        $(".rotate").click(function() {
            $(this).toggleClass("down");
        });
    });

    function updateVirusTotal(scan_id)  {
        $.get("/update_virustotal/" + scan_id, function(data) {
            window.location.reload()
        });
    }
</script>
{% endblock %}